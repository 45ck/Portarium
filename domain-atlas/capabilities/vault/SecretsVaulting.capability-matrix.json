{
  "schemaVersion": "1.0.0",
  "providerId": "vault",
  "providerName": "HashiCorp Vault",
  "portFamily": "SecretsVaulting",
  "adapterVersion": "0.1.0",
  "auth": {
    "modes": ["other"],
    "notes": "Vault API access is typically via a token (X-Vault-Token header) obtained from an auth method (OIDC, Kubernetes, AppRole, etc.). Model this as auth mode 'other' and declare the concrete method in adapter config."
  },
  "limits": {
    "notes": "Self-hosted; treat limits as deployment-specific and versioned per tenant."
  },
  "events": {
    "supportsWebhooks": false,
    "supportsPolling": true,
    "supportsEventStream": false,
    "notes": "Vault emits audit logs via audit devices; there is no standard outbound webhook surface. Polling the HTTP API is the portable baseline."
  },
  "idempotency": {
    "supportsIdempotencyKey": false,
    "notes": "No generic idempotency key support. Many operations are idempotent by path/name; secret writes are often versioned (non-idempotent) unless guarded by check-and-set semantics."
  },
  "diff": {
    "supportsPlan": true,
    "supportsPredictedEffects": false,
    "supportsVerifiedEffects": true,
    "notes": "Verified effects via post-write reads and audit/evidence capture. Predicted effects require adapter-side simulation; provider does not expose a dry-run API."
  },
  "capabilities": [
    {
      "capability": "mount:read",
      "supported": true,
      "operations": ["listMounts", "getMount"],
      "safety": {
        "defaultTier": "Auto",
        "requiresApproval": false,
        "idempotent": true
      }
    },
    {
      "capability": "mount:write",
      "supported": true,
      "operations": ["mount", "unmount", "tuneMountConfig", "remount"],
      "safety": {
        "defaultTier": "HumanApprove",
        "requiresApproval": true,
        "idempotent": false,
        "supportsRollback": false,
        "supportsCompensation": true
      },
      "notes": "Mount changes are high-blast-radius and may be irreversible depending on secret engine state. Compensation is best-effort (e.g., re-mount at prior path), not a true rollback."
    },
    {
      "capability": "audit:read",
      "supported": true,
      "operations": ["listAuditDevices", "auditHash"],
      "safety": {
        "defaultTier": "Auto",
        "requiresApproval": false,
        "idempotent": true
      }
    },
    {
      "capability": "audit:write",
      "supported": true,
      "operations": ["enableAuditDevice", "disableAuditDevice"],
      "safety": {
        "defaultTier": "HumanApprove",
        "requiresApproval": true,
        "idempotent": false,
        "supportsRollback": true
      },
      "notes": "Disabling audit devices can reduce evidence quality. Treat as high-liability and ensure policy requires explicit approvals."
    },
    {
      "capability": "policy:read",
      "supported": true,
      "operations": ["listPolicies", "getPolicy"],
      "safety": {
        "defaultTier": "Auto",
        "requiresApproval": false,
        "idempotent": true
      }
    },
    {
      "capability": "policy:write",
      "supported": true,
      "operations": ["putPolicy", "deletePolicy"],
      "safety": {
        "defaultTier": "HumanApprove",
        "requiresApproval": true,
        "idempotent": false,
        "supportsRollback": false,
        "supportsCompensation": true
      },
      "notes": "Policy changes are authorization changes. Compensation is best-effort via restoring prior policy text from evidence."
    },
    {
      "capability": "secret:read",
      "supported": true,
      "operations": ["readKvV2Secret", "readKvV2Metadata"],
      "safety": {
        "defaultTier": "Auto",
        "requiresApproval": false,
        "idempotent": true
      }
    },
    {
      "capability": "secret:write",
      "supported": true,
      "operations": ["writeKvV2Secret", "patchKvV2Secret", "deleteKvV2Secret", "destroyKvV2Secret"],
      "safety": {
        "defaultTier": "HumanApprove",
        "requiresApproval": true,
        "idempotent": false,
        "supportsRollback": false,
        "supportsCompensation": true
      },
      "notes": "KV v2 writes create new versions; use CAS/check-and-set to reduce risk. Destructive actions (destroy) must default to stricter policy tiers."
    },
    {
      "capability": "token:create",
      "supported": true,
      "operations": ["createToken"],
      "safety": {
        "defaultTier": "HumanApprove",
        "requiresApproval": true,
        "idempotent": false,
        "supportsRollback": false,
        "supportsCompensation": true
      },
      "notes": "Tokens grant access; treat as sensitive credential issuance. Compensation via revocation."
    },
    {
      "capability": "token:revoke",
      "supported": true,
      "operations": ["revokeToken", "revokeTokenTree"],
      "safety": {
        "defaultTier": "HumanApprove",
        "requiresApproval": true,
        "idempotent": true,
        "supportsRollback": false
      },
      "notes": "Revocation is generally idempotent and irreversible."
    }
  ],
  "notes": "Initial matrix derived from Vault HTTP API semantics and Go API client structs under api/. Refine against a concrete deployment policy (namespaces, auth methods, secret engine choices)."
}
