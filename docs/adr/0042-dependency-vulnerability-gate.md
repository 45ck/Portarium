# ADR-0042: Dependency Vulnerability Gate (npm audit)

## Status

Accepted

## Context

Portarium is a control plane. A compromised dependency (runtime or dev-time) is a direct risk to:

- tenant data handling,
- credential handling,
- build/CI integrity, and
- operator trust in evidence/audit outputs.

We want a simple, always-on gate that detects known high-severity vulnerabilities in our dependency graph.

## Decision

Run `npm audit --audit-level=high` as part of the PR gate suite (`npm run ci:pr`).

Rationale:

- `npm audit` is built-in and cheap to run.
- `--audit-level=high` keeps the signal focused on material issues and avoids frequent breakage on low/medium advisories.

## Consequences

Positive:

- Detects known high-severity vulnerabilities early (before merge).
- Makes dependency security drift visible and actionable.

Negative:

- Can be noisy when advisories are disputed or when fixes require transitive upgrades.
- Requires network access in CI.

## Handling Failures

When the gate fails:

1. Prefer upgrading the affected package(s) (`npm update` / targeted dependency bumps).
2. If a transitive dependency is stuck, consider `overrides` in `package.json` with a clear justification and follow-up to remove it once upstream resolves.
