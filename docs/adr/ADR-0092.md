# ADR-0092: SROS2 and DDS-Security Hardening for ROS 2 Mission Traffic

**Status:** Accepted
**Date:** 2026-02-22
**Bead:** bead-0520
**Supersedes:** _(none)_
**Related:** ADR-0070 (hybrid orchestration), ADR-0087 (gRPC mission gateway), ADR-0088 (MQTT mission gateway), ADR-0089 (ROS 2 Action bridge)

---

## Context

Portarium dispatches mission goals and receives telemetry over ROS 2 (DDS) topics. Without security hardening, any node on the same DDS domain can:

- Inject spurious mission goals or e-stop commands (spoofing).
- Eavesdrop on robot telemetry (confidentiality breach).
- Replay previously valid commands at a later time (replay attack).

The ROS 2 security model (SROS2) builds on the OMG DDS Security 1.1 specification and provides:

1. **Authentication** — X.509 mutual authentication via the DDS:Auth:PKI-DH plugin.
2. **Access control** — Signed XML policies (governance + per-enclave permissions) enforced by the DDS:Access:Permissions plugin.
3. **Cryptography** — RTPS payload encryption via the DDS:Crypto:AES-GCM-GMAC plugin.

---

## Decision

Apply SROS2 hardening to all Portarium bridge nodes operating in production domains with the following profile:

### Trust domain

| Parameter             | Value                                                 |
| --------------------- | ----------------------------------------------------- |
| DDS Domain ID         | 42 (production)                                       |
| Keystore path         | `/etc/portarium/sros2_keystore`                       |
| CA lifetime           | 10 years (offline PKI CA)                             |
| Enclave cert lifetime | 90 days (auto-renewed via SPIFFE/SPIRE, see ADR-0093) |

### Protection levels by topic class

| Topic pattern                 | Data protection | Metadata protection                  |
| ----------------------------- | --------------- | ------------------------------------ |
| `portarium/mission_goal`      | `ENCRYPT`       | `ENCRYPT_WITH_ORIGIN_AUTHENTICATION` |
| `portarium/estop`             | `ENCRYPT`       | `ENCRYPT_WITH_ORIGIN_AUTHENTICATION` |
| `*/_action/*` (Nav2 feedback) | `SIGN`          | `SIGN`                               |
| `robot/*` (telemetry)         | `SIGN`          | `SIGN`                               |
| All other topics (catch-all)  | `ENCRYPT`       | `ENCRYPT_WITH_ORIGIN_AUTHENTICATION` |

### Node access control

- `unauthenticated_participants`: DENY
- `join_access_control`: ENABLED
- Discovery protection: `ENCRYPT_WITH_ORIGIN_AUTHENTICATION`
- RTPS protection: `ENCRYPT`

### Enclave permissions (portarium_bridge)

The bridge enclave (`/portarium_bridge`) is granted:

**Publish:** `portarium/mission_goal`, `portarium/estop`, `portarium/bridge_status`
**Subscribe:** `*/_action/*`, `robot/*`, `rosbridge/action_result`
**Action client:** `navigate_to_pose`, `dock`, `undock`, `spin`, `follow_waypoints`

All other publish/subscribe permissions are implicitly denied.

### Key bootstrap

A `keystore-bootstrap.sh` script (`infra/ros2-bridge/sros2/`) drives the
one-time keystore initialisation on each host:

1. `ros2 security create_keystore` — initialise directory structure.
2. Install CA cert/key from offline PKI.
3. Sign governance.xml → `governance.p7s` via `openssl smime`.
4. `ros2 security create_enclave` + sign permissions.xml → `permissions.p7s`.

### Runtime environment variables

```bash
export ROS_SECURITY_ENABLE=true
export ROS_SECURITY_STRATEGY=Enforce     # Fail-closed: deny if policy missing
export ROS_SECURITY_KEYSTORE=/etc/portarium/sros2_keystore
export ROS_SECURITY_ENCLAVE_OVERRIDE=/portarium_bridge
```

`ROS_SECURITY_STRATEGY=Enforce` is mandatory in production. `Permissive` mode
(log-only) is acceptable only in staging.

---

## Alternatives Considered

### No DDS-Security (current state)

Rejected. Unacceptable for production: any host on the robot LAN can inject commands.

### DDS-over-TLS only (no SROS2)

Rejected. DDS transport security does not provide per-topic access control or
node-level authentication. SROS2 provides both.

### VPN / network perimeter only

Rejected as sole control. Defence-in-depth requires application-layer security
independent of network topology.

---

## Consequences

**Positive**

- Mission goals and e-stop commands are encrypted and origin-authenticated end-to-end.
- Rogue nodes on the robot LAN cannot inject commands or read telemetry without a valid enclave certificate.
- Per-topic policy is auditable from signed XML artefacts committed to the repository.

**Negative / trade-offs**

- Initial keystore bootstrap requires out-of-band CA key distribution (mitigated by SPIFFE/SPIRE in ADR-0093).
- Encryption adds ~2–5 µs per message for AES-GCM; acceptable at 100 Hz telemetry rates.
- Enclave cert rotation requires bridge restart unless DDS runtime supports hot-reload (vendor-dependent).

---

## References

- OMG DDS Security 1.1 — <https://www.omg.org/spec/DDS-SECURITY/1.1>
- SROS2 tutorial — <https://docs.ros.org/en/rolling/Tutorials/Advanced/Security/Introducing-ros2-security.html>
- Nav2 Security guide — <https://navigation.ros.org/security/index.html>
